{"version":3,"sources":["dropcars/dropCars.ts"],"names":["G","_super","_this","apply","this","arguments","count","v","ballList","score","__extends","prototype","newGame","createRole","call","control","running","role","draw","forEach","ball","createBoll","scoreScreen","change","drop","checkHits","hits","over","gameOver","gameOverStage","setText","loading","console","log","Sprite","context","rect","stage","width","setSize","w","jump","bindEvent","epos","col","height","Math","ceil","bind","obj","x","setPosition","h","setBallInitPosition","min","colPos","rnd","random","i","Ball","floor","length","push","splice","index","JY","y","view","document","getElementById","offsetWidth","offsetHeight","Stage","descript","Discript","text","GameOver","title","Title","Control","game","files","image","setup"],"mappings":"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","file":"dropCars.js","sourcesContent":["/// <reference path=\"../../src/index.ts\" />\r\n(function () {\r\n    class G extends JY {\r\n        interval: 20;\r\n        count = 1;\r\n        role: Sprite;\r\n        v = 2;//速度 \r\n        ballList: Array<Ball> = [];//球的集合\r\n        score: number = 0;\r\n        scoreScreen:Score;\r\n        newGame() {\r\n            this.count = 1;\r\n            this.v = 2;\r\n            this.score = 0;\r\n            this.ballList = [];\r\n            //init\r\n            this.createRole();\r\n            super.newGame();\r\n            this.control();\r\n        }\r\n        running() {\r\n            super.running();\r\n            this.count++;\r\n            // console.log(this.count)\r\n            this.role.draw();\r\n            this.ballList.forEach(ball => {\r\n                ball.draw();\r\n            });\r\n            this.createBoll();\r\n            this.scoreScreen.change('您已行驶 '+ this.score+' 米');\r\n            this.drop();\r\n            this.checkHits();\r\n\r\n        }\r\n        checkHits(){\r\n            this.ballList.forEach(ball => {\r\n                if(this.hits(this.role,ball)){\r\n                    this.over()\r\n                }\r\n            });\r\n        }\r\n        gameOver() {\r\n            super.gameOver();\r\n            this.gameOverStage.setText('得分：'+this.score);\r\n        }\r\n        loading() {\r\n            console.log('loading...')\r\n            super.loading();\r\n        }\r\n        //创建英雄\r\n        createRole() {\r\n            this.role = new Sprite(this.context, 'car.png');\r\n            let rect = this.stage.width / 3 - 10;\r\n            this.role.setSize(rect, rect);\r\n            let x = this.stage.width / 2 - this.role.w / 2;\r\n            // this.role.setPosition(this.stage.width/3,this.stage.height - this.role.h);\r\n            this.jump(1, this.role);\r\n        }\r\n        //控制器\r\n        control() {\r\n            this.stage.bindEvent(function (epos) {\r\n                let w = this.stage.width;\r\n                let h = this.stage.height;\r\n                let col = Math.ceil(epos[0] / (w / 3));//分三栏，判断点击是哪一栏\r\n                this.jump(col, this.role);\r\n            }.bind(this));\r\n        }\r\n        //跳啊\r\n        jump(col: number, obj: Sprite) {\r\n            let x = this.stage.width / 3 * col - this.stage.width / 3 / 2 - this.role.w / 2;\r\n            obj.setPosition(x, this.stage.height / 2 + this.role.h);\r\n        }\r\n        //设置球的初始位置\r\n        setBallInitPosition(ball: Sprite, col: number) {\r\n            let x = this.stage.width / 3 * col - this.stage.width / 3 / 2 - ball.w / 2;\r\n            ball.setPosition(x, 0);\r\n        }\r\n        createBoll() {\r\n            //创建小球\r\n            if (this.count % 100 == 0) {\r\n                this.v = Math.min(this.v + .3,5);\r\n                this.score++;\r\n                //10帧创建\r\n                let colPos = [1, 2, 3];//三列中的某一列\r\n                let rnd = Math.ceil(Math.random() * 2);//创建一个或2;\r\n                let i = 0;\r\n                while (true) {\r\n                    let ball = new Ball(this.context, this.stage.width / 3 - 10, this.stage.width / 4);\r\n                    let col = Math.floor(Math.random() * colPos.length);\r\n                    this.setBallInitPosition(ball, colPos[col]);\r\n                    this.ballList.push(ball);\r\n                    colPos.splice(col, 1);\r\n                    i++;\r\n                    if (i >= rnd) {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        drop() {\r\n            this.ballList.forEach((ball,index) => {\r\n                ball.drop(this.v);\r\n                if(ball.x >this.stage.height){\r\n                    this.ballList.splice(index,1)\r\n                }\r\n            });\r\n        }\r\n    }\r\n    class Ball extends Sprite {\r\n        constructor(context, w, h) {\r\n            super(context, 'car1.png');\r\n            this.setSize(w, h);\r\n        }\r\n        drop(v: number) {\r\n            this.setPosition(this.x, this.y + v)\r\n        }\r\n    }\r\n    let view = document.getElementById('view');\r\n    let w = view.offsetWidth;\r\n    let h = view.offsetHeight;\r\n    let stage = new Stage(w, h);\r\n    let descript = new Discript('start');\r\n    descript.text = '<p class=\"title\">碰撞汽车</p>'\r\n    let gameOver = new GameOver('restart');\r\n    let title = new Title('碰撞汽车');\r\n    let control = new Control();\r\n    control.rect = [100, 100]\r\n    let game = new G(view, stage, title, descript, gameOver);\r\n    game.files = { image: ['car1.png', 'car2.png', 'car.png'] };\r\n    game.setup();\r\n})();"]}